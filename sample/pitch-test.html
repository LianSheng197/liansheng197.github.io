<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        var source = '';

        function playSound(file, speed = 1, pitchShift = 1, loop = false, autoplay = true) {
            if (pitchShift) {
                audioCtx = new(window.AudioContext || window.webkitAudioContext)();
                source = audioCtx.createBufferSource();
                request = new XMLHttpRequest();

                request.open('GET', file, true);

                request.responseType = 'arraybuffer';

                request.onload = function () {
                    var audioData = request.response;

                    audioCtx.decodeAudioData(audioData, function (buffer) {
                            myBuffer = buffer;
                            songLength = buffer.duration;
                            source.buffer = myBuffer;
                            source.playbackRate.value = speed;
                            source.connect(audioCtx.destination);
                            source.loop = loop;
                        },

                        function (e) {
                            "Error with decoding audio data" + e.error
                        });

                }

                request.send();
                source.play = source.start
            } else {
                source = new Audio(file)
                source.playbackRate = speed
                source.loop = loop
            }
            if (autoplay) {
                source.play()
            }
            return source
        }

        function play() {
            source = playSound('./audio/esf - made of stardust.mp3', 0.75, false, true);
        }

        function stop() {
            source.pause();
            document.getElementById('play').href = ''
            document.getElementById('play').innerHTML = 'Refresh to play again'
        }
    </script>
    <a id="play" href="#" onclick="play()">Play</a> | <a href="#" onclick="stop()">Stop</a>
    <br><br><br><br>
    <audio id="init" src="./audio/esf - made of stardust.mp3" controls loop></audio>

</body>

</html>